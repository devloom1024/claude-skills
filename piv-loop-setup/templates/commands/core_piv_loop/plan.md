---
description: 创建功能详细实施计划
argument-hint: [功能描述]
---

# /piv:plan：创建实施计划

## 输入

用户需求描述：`$ARGUMENTS`

## 第一阶段：需求理解

1. 提取核心问题
2. 识别用户价值和业务影响
3. 确定功能类型：新增 / 增强 / 重构 / 修复
4. 评估复杂度：低 / 中 / 高

## 第二阶段：代码库分析

1. 列出相关文件：
   ```bash
   git ls-files | grep -E "src|test|spec"
   ```

2. 阅读关键实现文件，理解：
   - 目录结构约定
   - 编码模式（命名、结构、错误处理、日志）
   - 类似功能如何实现

3. 识别可参考的实现模式

## 第三阶段：外部研究（如需要）

1. 查阅官方文档的模式
2. 研究特定功能的最佳实践
3. 识别常见陷阱

## 第四阶段：深度思考

考虑：
- 这如何融入现有架构？
- 依赖项和执行顺序是什么？
- 可能出错的地方？
- 需要什么测试？

## 第五阶段：生成计划

在 `.agents/plans/` 创建计划，结构如下：

```markdown
# 功能：[名称]

## 描述
[2-3 句话]

## 用户故事
作为[用户类型]
我希望[功能]
以便[价值]

## 问题定义
[问题定义]

## 解决方案
[解决方案概述]

## 元数据
- 类型：[新增 / 增强 / 重构 / 修复]
- 复杂度：[低 / 中 / 高]
- 影响系统：[...]

---

## 上下文引用

### 需要阅读的代码库文件
- `path/to/file.ext`（第 X-Y 行）- 原因：需要遵循的模式

### 需要新建的文件
- `path/to/new_service.ext` - 用途

### 需要参考的文档
- [链接](#section) - 原因：用于实现 X

### 需要遵循的模式
[从代码库提取的模式]

---

## 实施计划

### 第一阶段：基础
[描述]

### 第二阶段：核心实现
[描述]

### 第三阶段：集成
[描述]

### 第四阶段：测试
[描述]

---

## 步骤化任务

### {操作} {目标文件}

- **实现**：<具体实现细节>
- **模式**：<参考 - 文件:行号>
- **导入**：<需要的导入>
- **注意事项**：<已知问题或约束>
- **验证**：`<验证命令>`

---

## 测试策略
[基于项目测试框架]

## 验证命令
```bash
[lint 命令]
[test 命令]
```

## 验收标准
- [ ] 所有功能实现
- [ ] 所有验证通过
- [ ] 测试覆盖边界情况
```

## 输出

1. 计划文件路径
2. 关键决策
3. 识别的风险
4. 需要澄清的问题（如果有）
